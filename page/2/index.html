<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sortbylist.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Java coder">
<meta property="og:type" content="website">
<meta property="og:title" content="书生小栈">
<meta property="og:url" content="http://sortbylist.github.io/page/2/index.html">
<meta property="og:site_name" content="书生小栈">
<meta property="og:description" content="Java coder">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jerry Lee">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://sortbylist.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>书生小栈</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">书生小栈</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2017/02/08/java-nio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/08/java-nio/" class="post-title-link" itemprop="url">Java NIO回顾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-08 17:29:05" itemprop="dateCreated datePublished" datetime="2017-02-08T17:29:05+08:00">2017-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Java-NIO"><a href="#Java-NIO" class="headerlink" title="Java NIO"></a>Java NIO</h3><ul>
<li>Channels通道（连接）<ul>
<li>FileChannel</li>
<li>DatagramChannel</li>
<li>SocketChannel</li>
<li>ServerSocketChannel</li>
<li>Pipe.SinkChannel</li>
<li>Pipe.SourceChannel</li>
</ul>
</li>
<li>Buffers缓冲区<ul>
<li>ByteBuffer</li>
<li>CharBuffer</li>
<li>DoubleBuffer</li>
<li>FloatBuffer</li>
<li>LongBuffer</li>
<li>IntBuffer</li>
<li>ShortBuffer</li>
<li>MappedByteBuffer</li>
</ul>
</li>
<li>Selectors</li>
<li>Pipe（管道）</li>
</ul>
<h4 id="FileChannel"><a href="#FileChannel" class="headerlink" title="FileChannel"></a>FileChannel</h4><p>FileChannel是一个连接到文件的通道。可以通过文件通道读写文件。</p>
<p>FileChannel无法设置为非阻塞模式，它总是运行在阻塞模式下。</p>
<blockquote>
<p>在Java NIO中，如果两个通道中有一个是FileChannel，那你可以直接将数据从一个channel（译者注：channel中文常译作通道）传输到另外一个channel。</p>
</blockquote>
<ul>
<li><p>FileChannel的基本用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">aFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;data/nio-data.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">inChannel</span> <span class="operator">=</span> aFile.getChannel(); <span class="comment">//获取FileChannel</span></span><br><span class="line"></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> inChannel.read(buf); <span class="comment">//读取FileChannel中数据至ByteBuffer</span></span><br><span class="line"><span class="type">long</span> <span class="variable">pos</span> <span class="operator">=</span> inChannel.position(); <span class="comment">//获取FileChannel的当前位置</span></span><br><span class="line">inChannel.position(<span class="number">0</span>); <span class="comment">//设置FileChannel的当前位置,在此位置之后进行读或写</span></span><br><span class="line">buf.flip(); <span class="comment">//ByteBuffer从写模式转到读模式</span></span><br><span class="line">inChannel.write(buf);<span class="comment">//再将ByteBuffer中数据写入FileChannel</span></span><br><span class="line"><span class="type">long</span> <span class="variable">fileSize</span> <span class="operator">=</span> inChannel.size(); <span class="comment">//返回此通道的文件的当前大小</span></span><br><span class="line">inChannel.truncate(fileSize / <span class="number">2</span>); <span class="comment">//截取文件</span></span><br><span class="line">inChannel.force(<span class="literal">true</span>); <span class="comment">//强制数据写入磁盘，参数表示是否同时将文件元数据（权限信息等）写到磁盘上。</span></span><br><span class="line">inChannel.close(); <span class="comment">//关闭</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>transferFrom()</p>
<blockquote>
<p>FileChannel的transferFrom()方法可以将数据从源通道传输到FileChannel中（译者注：这个方法在JDK文档中的解释为将字节从给定的可读取字节通道传输到此通道的文件中）。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">fromFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;fromFile.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">fromChannel</span> <span class="operator">=</span> fromFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">toFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;toFile.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">toChannel</span> <span class="operator">=</span> toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> fromChannel.size();</span><br><span class="line">toChannel.transferFrom(fromChannel, position, count);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此外要注意，在SoketChannel的实现中，SocketChannel只会传输此刻准备好的数据（可能不足count字节）。因此，SocketChannel可能不会将请求的所有数据(count个字节)全部传输到FileChannel中。</p>
</blockquote>
</li>
<li><p>transferTo()</p>
<blockquote>
<p>transferTo()方法将数据从FileChannel传输到其他的channel中。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">fromFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;fromFile.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">fromChannel</span> <span class="operator">=</span> formFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="type">RandomAccessFile</span> <span class="variable">toFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;toFile.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"><span class="type">FileChannel</span> <span class="variable">toChannel</span> <span class="operator">=</span> toFile.getChannel();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> count=  fromChannel.size();</span><br><span class="line">fromChannel.transferTo(position, count, toChannel);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="SocketChannel"><a href="#SocketChannel" class="headerlink" title="SocketChannel"></a>SocketChannel</h4><blockquote>
<p>Java NIO中的SocketChannel是一个连接到TCP网络套接字的通道。可以通过以下2种方式创建SocketChannel：</p>
<ol>
<li>打开一个SocketChannel并连接到互联网上的某台服务器。</li>
<li>一个新连接到达ServerSocketChannel时，会创建一个SocketChannel。</li>
</ol>
</blockquote>
<ul>
<li><p>SocketChannel基本用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过调用系统级默认 SelectorProvider 对象的 openSocketChannel 方法来创建新的通道。 </span></span><br><span class="line"><span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open(); <span class="comment">//打开套接字通道</span></span><br><span class="line"><span class="comment">//如果通道处于非阻塞模式，则发起一个非阻塞连接操作。如果立即建立连接（使用本地连接时就是如此），则返回true。否则此方法返回 false，并且必须在以后通过调用 finishConnect 方法来完成该连接操作。</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isConnectNow</span> <span class="operator">=</span> socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;www.baidu.com&quot;</span>), <span class="number">80</span>); <span class="comment">//连接到某个套接字</span></span><br><span class="line"><span class="keyword">if</span>(!isConnectNow) &#123;</span><br><span class="line">  socketChannel.finishConnect();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(buf);<span class="comment">//从SocketChannel读取数据到ByteBuffer</span></span><br><span class="line">buf.flip();<span class="comment">//反转ByteBuffer,此时limit=position,postion=0，一般与compact()配合使用</span></span><br><span class="line">socketChannel.write(buf); <span class="comment">//写入SocketChannel;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>SocketChannel非阻塞模式</p>
<blockquote>
<p>非阻塞模式与选择器搭配会工作的更好，通过将一或多个SocketChannel注册到Selector，可以询问选择器哪个通道已经准备好了读取，写入等。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">socketChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;http://baidu.com&quot;</span>), <span class="number">80</span>);</span><br><span class="line"><span class="keyword">while</span>(!socketChannel.finishConnect()) &#123;</span><br><span class="line">  <span class="comment">//waitting for connecting...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">socketChannel.read(buf);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(buf.hasRemaing()) &#123;</span><br><span class="line">  socketChannel.write(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ServerSocketChannel"><a href="#ServerSocketChannel" class="headerlink" title="ServerSocketChannel"></a>ServerSocketChannel</h4><p>针对面向流的侦听套接字的可选择通道。 </p>
<ul>
<li><p>ServerSocketChannel基本用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">serverSocketChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line">serverSocketChannel.configureBlocking(<span class="literal">false</span>); <span class="comment">//非阻塞模式</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">if</span>(socketChannel != <span class="literal">null</span>) &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">serverSocketChannel.close();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="DatagramChannel"><a href="#DatagramChannel" class="headerlink" title="DatagramChannel"></a>DatagramChannel</h4><blockquote>
<p>Java NIO中的DatagramChannel是一个能收发UDP包的通道。因为UDP是无连接的网络协议，所以不能像其它通道那样读取和写入。它发送和接收的是数据包。</p>
</blockquote>
<ul>
<li><p>DatagramChannel基本用法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DatagramChannel</span> <span class="variable">channel</span> <span class="operator">=</span> DatagramChannel.open();</span><br><span class="line">channel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9999</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buf</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">buf.clear();</span><br><span class="line">channel.receive(buf); <span class="comment">//接收数据，如果buf大小不够，则会被丢弃</span></span><br><span class="line"></span><br><span class="line">buf.flip();</span><br><span class="line"><span class="type">int</span> <span class="variable">bytesSend</span> <span class="operator">=</span> channel.send(buf, <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;baidu.com&quot;</span>, <span class="number">80</span>)); <span class="comment">//发送数据</span></span><br><span class="line"><span class="comment">//连接到特定的地址，让其只能从特定地址收发数据，减少安全检查开销</span></span><br><span class="line">channel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;baidu.com&quot;</span>, <span class="number">80</span>));</span><br><span class="line"><span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> channel.read(buf);</span><br><span class="line"><span class="type">int</span> <span class="variable">bytesWritten</span> <span class="operator">=</span> channel.write(buf);</span><br></pre></td></tr></table></figure></li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/02/08/java-nio/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2017/02/08/java%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/08/java%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE/" class="post-title-link" itemprop="url">Java基础回顾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-02-08 17:08:59" itemprop="dateCreated datePublished" datetime="2017-02-08T17:08:59+08:00">2017-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-09 13:41:07" itemprop="dateModified" datetime="2019-04-09T13:41:07+08:00">2019-04-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Java-多态"><a href="#Java-多态" class="headerlink" title="Java 多态"></a>Java 多态</h1><p>父类对象引用子类实例。子类继承父类后，同一个方法有不同的表现。</p>
<ul>
<li>方法重载实现静态多态性（编译时多态）</li>
<li>方法重写实现的动态多态性（运行时多态）</li>
</ul>
<h1 id="Java-虚拟机"><a href="#Java-虚拟机" class="headerlink" title="Java 虚拟机"></a>Java 虚拟机</h1><h2 id="Java程序执行过程"><a href="#Java程序执行过程" class="headerlink" title="Java程序执行过程"></a>Java程序执行过程</h2><ul>
<li><em>Java Source (.java File)</em></li>
<li>Java Compiler(javac)</li>
<li><em>Java Byte Code(.class File)</em></li>
<li><strong>Class Loader</strong></li>
<li>Execution Engine</li>
<li><strong>Runtime Data Areas</strong></li>
<li>Java Virtual Machine</li>
</ul>
<h2 id="类加载器-（-Class-Loader-）"><a href="#类加载器-（-Class-Loader-）" class="headerlink" title="类加载器 （ **Class Loader ** ）"></a>类加载器 （ **Class Loader ** ）</h2><ul>
<li>Bootstrap Class Loader</li>
<li>Extension Class Loader</li>
<li>System Class Loader</li>
<li>User-Defined Class Loader</li>
</ul>
<h2 id="运行数据区域-（-Runtime-Data-Areas-）"><a href="#运行数据区域-（-Runtime-Data-Areas-）" class="headerlink" title="运行数据区域 （ Runtime Data Areas ）"></a>运行数据区域 （ <strong>Runtime Data Areas</strong> ）</h2><ul>
<li><p>PC Register<br>每个线程有一个PC计数器。当线程启动时，PC计数器被创建，这个计数器存放当前正在被执行的字节码指令（ JVM 指令 ）的地址。</p>
</li>
<li><p>JVM Stack<br>Java栈中存放着一系列的栈桢（ Stack Frame ），JVM 只能进行压入（ Push ） 和弹出 （ Pop ) 栈帧这两种操作。每当调用 一个方法时，JVM就往栈里压入一个栈帧，方法结束返回时弹出栈帧。如果方法执行时异常，可以调用printStackTrace 等方法来查看栈的情况。</p>
<ul>
<li>Stack Frame<ul>
<li>Local Variable Array 局部变量队列</li>
<li>Operand Stack 操作数栈</li>
<li>Reference to Constant Pool常量池引用</li>
</ul>
</li>
</ul>
</li>
<li><p>Native Method Stack<br>当程序通过 JNI（Java Native Interface）调用本地方法（如 C 或者 C++ 代码）时，就根据本地方法的语言类型建立相应的栈。</p>
</li>
<li><p>Heap<br>堆中存放的是程序创建的对象或者实例。这个区域对 JVM 的性能影响很大。垃圾回收机制处理的正是这一块内存区域。 所以，类加载器加载其实就是根据编译后的 Class 文件，将 java 字节码载入 JVM 内存，并完成对运行数据处的初始化工作，供执行引擎执行。</p>
</li>
<li><p>Method Area<br>方法区域是一个 JVM 实例中的所有线程共享的，当启动一个 JVM 实例时，方法区域被创建。它用于存运行时常量池、有关域和方法的信息、静态变量、类和方法的字节码。不同的 JVM 实现方式在实现方法区域的时候会有所区别。Oracle 的 HotSpot 称之为永久区域（Permanent Area）或者永久代（Permanent Generation）。</p>
</li>
<li><p>Runtime Constant Pool</p>
<p>这个区域存放类和接口的常量，除此之外，它还存放方法和域的所有引用。当一个方法或者域被引用的时候，JVM 就通过运行常量池中的这些引用来查找方法和域在内存中的的实际地址。</p>
</li>
</ul>
<p> </p>
<p>前三个属于每个线程独自拥有。后三者是整个JVM实例中所有线程共有的。</p>
<h2 id="执行引擎-（Execution-Engine-）"><a href="#执行引擎-（Execution-Engine-）" class="headerlink" title="执行引擎 （Execution Engine ）"></a>执行引擎 （Execution Engine ）</h2><p>类加载器将字节码载入内存之后，执行引擎以Java字节码指令为单元，读取Java字节码。通过解释器将字节码转化成平台相关的机器码，这个过程也可以由即时编译器 （ JIT Compiler ） 来完成。</p>
<h1 id="Java内存管理"><a href="#Java内存管理" class="headerlink" title="Java内存管理"></a>Java内存管理</h1><h2 id="Java的内存管理就是对象的分配和释放问题。"><a href="#Java的内存管理就是对象的分配和释放问题。" class="headerlink" title="Java的内存管理就是对象的分配和释放问题。"></a>Java的内存管理就是对象的分配和释放问题。</h2><ul>
<li><p>分配</p>
<p>内存分配由程序完成，使用 new 关键词为对象申请内存空间（基本类型除外），所有的对象都在堆（ Heap ) 中分配空间。</p>
</li>
<li><p>释放</p>
<p>对象的释放由垃圾回收机制（ GC ）决定和执行。</p>
</li>
</ul>
<h2 id="Java的内存区域分栈内存和堆内存"><a href="#Java的内存区域分栈内存和堆内存" class="headerlink" title="Java的内存区域分栈内存和堆内存"></a>Java的内存区域分栈内存和堆内存</h2><h3 id="栈内存"><a href="#栈内存" class="headerlink" title="栈内存"></a>栈内存</h3><p>在函数中定义的基本类型变量和对象的引用变量都在函数的栈内存中分配。在函数（代码块）中定义一个变量时， java 就在栈中为这个变量分配内存空间，当超过变量的作用域后，java 会自动释放掉为该变量所分配的内存空间。</p>
<h3 id="堆内存"><a href="#堆内存" class="headerlink" title="堆内存"></a>堆内存</h3><p>用来存放由 new 创建的对象和数组以及对象的实例变量。在堆中分配的内存由 java 虚拟机的自动垃圾回收器来管理。</p>
<ul>
<li>堆的优点是可以动态分配内存大小，生存期也不必事先告诉编译器，因为它是在运行时动态分配内存的。缺点是在运行时动态分配内存，存取速度较慢</li>
<li>栈的优点是存取速度比堆要快，仅次于直接位于CPU中的寄存器。另外栈数据可以共享。缺点是存在栈中的数据大小与生存期必须是确定的，缺乏灵活性。</li>
</ul>
<h3 id="Java中数据在内存中的存储位置"><a href="#Java中数据在内存中的存储位置" class="headerlink" title="Java中数据在内存中的存储位置"></a>Java中数据在内存中的存储位置</h3><ul>
<li><p>基本数据类型（8种，即int, short, long, byte, float, double, boolean, char）。保存在栈中，并且共享。所以</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">System.out.println(s1==s2);<span class="comment">//true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;joally&quot;</span>, <span class="number">24</span>);</span><br><span class="line"><span class="comment">//1.Person p声明一个对象Person，其引用命名为p,此时在栈内存中为引用变量p分配内存空间，此时p是空对象，等同于Person p = null;</span></span><br><span class="line"><span class="comment">//2.p = new Person(&quot;joally&quot;, 24)在堆内存中为类的成员变量name和age分配内存，并将其初始化为各数据类型的默认值；接着进行显式初始化（类定义时的初始化值）；最后调用构造方法，为成员变量赋值。返回堆内存中对象的引用（相当于首地地址）给引用变量p，以后就可以通过栈内存中的p来引用堆内存中的Person对象了。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数组</p>
<p>当定义一个数组时，在栈内存中创建一个数组引用，通过该引用（即数组名）来引用数组。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> x[]; <span class="comment">//在栈内存中创建数组引用x;</span></span><br><span class="line">x = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span>];<span class="comment">//在堆内存中分配3个保存int型数据的空间，并初始化为0，堆内存的首地址赋值给x，即通过栈内存中x来引用堆内存中的int数组。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>静态变量</p>
<p>用static修饰的变量和方法，实际上是指定了这些变量和方法在内存中的“固定位置” - static stoage，可以理解为所有实例对象共有的内存空间。静态表示的的是内存的共享，就是它的每一个实例都指向同一个内存地址，它的引用（含间接引用）都指向同一个位置。</p>
</li>
</ul>
<p>Java 程序的多个部分（方法，变量，对象）驻留在内存中以下两个位置：堆和栈。实例变量和对象驻留在堆上，局部变量驻留在栈上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">Collar c;</span><br><span class="line">String name;</span><br><span class="line"><span class="comment">//1. main()方法位于栈上</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//2. 在栈上创建引用变量d,但Dog对象尚未存在</span></span><br><span class="line">Dog d;</span><br><span class="line"><span class="comment">//3. 在堆中创建新的Dog对象，并将其赋予d引用变量</span></span><br><span class="line">d = <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="comment">//4. 将引用变量的一个副本传递给go()方法</span></span><br><span class="line">d.go(d);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//5. 将go()方法置于栈上，并将dog参数作为局部变量</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">go</span><span class="params">(Dog dog)</span>&#123;</span><br><span class="line"><span class="comment">//6. 在堆上创建新的Collar对象，并将其赋予Dog的实例变量</span></span><br><span class="line">c =<span class="keyword">new</span> <span class="title class_">Collar</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//7.将setName()添加到栈上，并将dogName参数作为其局部变量</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String dogName)</span>&#123;</span><br><span class="line"><span class="comment">//8. name的实例对象也引用String对象</span></span><br><span class="line">name=dogName;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//9. 程序执行完成后，setName()将会完成并从栈中清除，此时，局部变量dogName也会消失，尽管它所引用的String仍在堆上</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Java泛型"><a href="#Java泛型" class="headerlink" title="Java泛型"></a>Java泛型</h1><p>泛型的主要目标是提高 Java 程序的类型安全。消除强制类型转换，提高代码可读性，减少出错机会。</p>
<h1 id="Java序列化"><a href="#Java序列化" class="headerlink" title="Java序列化"></a>Java序列化</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>序列化，就是为了保存对象的状态，与之对应的是反序列化，就是把保存的对象状态再读出来。</p>
<blockquote>
<p>序列化&#x2F;反序列化，是Java提供一种专门用于保存&#x2F;恢复对象状态的机制。</p>
</blockquote>
<p>一般以下几种情况下，我们可能会用到序列化：</p>
<ul>
<li>想把内存中的对象状态保存到一个文件中或数据库中</li>
<li>想用套接字在网络上传送对象</li>
<li>想通过<strong>RMI ( Remote Method Invocation 远程连接调用 )</strong> 传输对象时</li>
</ul>
<h2 id="java-io-Serializable"><a href="#java-io-Serializable" class="headerlink" title="java.io.Serializable"></a><code>java.io.Serializable</code></h2><p>类通过实现<code>Serializable</code>接口，可实现自动序列化</p>
<ul>
<li>transient瞬态，用于不序列化的属性</li>
<li>静态变量，属于类的状态，不序列化</li>
<li>如果想自定义序列化的内容，类中需要实现<code>writeObject(java.io.ObjectOutputStream o)</code>&#x2F;<code>readObject(java.io.ObjectInputStream o)</code>方法，分别用于序列化和反序列化。自定义方法第一行可调用<code>out.defaultWriteObject()</code>&#x2F;<code>out.defaultReadObject()</code>来调用jdk的默认序列化，然后再实现自己的序列化</li>
</ul>
<h2 id="java-io-Externalizable"><a href="#java-io-Externalizable" class="headerlink" title="java.io.Externalizable"></a><code>java.io.Externalizable</code></h2><p>如果一个类要完全负责自己的序列化，则实现 Externalizable 接口，而不是 Serializable 接口。</p>
<blockquote>
<p>Externalizable接口定义包括两个方法<code>writeExternal()</code>与<code>readExternal()</code>。需要注意的是：声明类实现Externalizable接口会有重大的安全风险。<code>writeExternal()</code>与<code>readExternal()</code>方法声明为public，恶意类可以用这些方法读取和写入对象数据。如果对象包含敏感信息，则要格外小心。</p>
</blockquote>
<ul>
<li><code>writeExternal(ObjectOutput out)</code></li>
<li><code>readExernal(ObjectInput in)</code></li>
<li><code>readResolve</code>&#x2F;<code>writeReplace</code>可以用在单例模式时的序列化和反序列化，用于指定替代的对象</li>
</ul>
<h1 id="Java基本数据结构"><a href="#Java基本数据结构" class="headerlink" title="Java基本数据结构"></a>Java基本数据结构</h1><ul>
<li>boolean、char[2byte，16bit]、short[2byte，16bit]、int[4byte，32bit]、float[4byte，64bit]、long[8byte，64bit]、double[8byte，64bit]</li>
<li>基本数据包装类，继承于<code>java.lang.Number</code>类，包括：<code>java.lang.Byte</code>、<code>java.lang.Short</code>、<code>java.lang.Integer</code>、<code>java.lang.Float</code>、<code>java.lang.Long</code>、<code>java.lang.Double</code>，以及<code>java.lang.Boolean</code>、<code>java.lang.Character</code></li>
<li>Java字符，原始类型<code>char</code>，包装类<code>java.lang.Character</code>，jdk6基于Unicode Standard version4.0，jdk7基于Unicode Standard version6.0，jdk8基于Unicode verison6.2.0。</li>
<li>Unicode编码，使用“U+”然后紧接着一组十六进制的数字表示一个字符。从U+0000到U+FFFF的字符集被称作<em>Basic Multilingual Plane(BMP)</em>，又称作<code>零号平面</code>，其中的所有字符，要用四个数字（即2个char，16bit，例如U+4AE0，共支持2^16-1&#x3D;65535个字符）；在零号平面以外的字符则需要使用五个或六个数字，范围为U+0000到U+10FFFF，即通常所说的<em>Unicode标准量</em>。</li>
<li>java.lang.Math、java.util.Date、java.text.SimpleDateFormat、java.text.NumberFormat、java.text.MessageFormat、java.util.Calendar、java.util.GregorianCalendar</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2017/02/08/java%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2016/12/05/Dagger2%E8%AF%A6%E8%A7%A32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/05/Dagger2%E8%AF%A6%E8%A7%A32/" class="post-title-link" itemprop="url">Dagger2详解2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-05 09:56:10" itemprop="dateCreated datePublished" datetime="2016-12-05T09:56:10+08:00">2016-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前面我写了<a href="2016/10/03/Dagger2%E8%AF%A6%E8%A7%A31">Dagger2中2种注入的基本用法</a>，这篇文章来讲下Dagger2比较高级一点的用法。本文也是个人学习思考所得，如有错误之处，还请大家多多评论交流。</p>
<h3 id="Component间的依赖"><a href="#Component间的依赖" class="headerlink" title="@Component间的依赖"></a>@Component间的依赖</h3><p>在<a href="2016/10/03/Dagger2%E8%AF%A6%E8%A7%A31">Dagger2中2种注入的基本用法</a>中，我们按照大多数情况，按页面划分Component类，既一个页面对应一个Component类，这样便于管理。事实上除了在Activity的生存周期内的属性需要注入，很多情况下在Application生存周期内也有属性可以通过Dagger2来注入，这种属性一般是供整个应用来使用的。</p>
<p>因此如大部分教程一样，我们会定义一个全局的Component类来对应于应用的Application类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainApplicationModule.java</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplicationModule</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MainApplication application;</span><br><span class="line">  MainApplicationModule(MainApplication application) &#123;</span><br><span class="line">    <span class="built_in">this</span>.application = application;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  <span class="keyword">public</span> Context <span class="title function_">providerApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> application;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplicationComponent.java</span></span><br><span class="line"><span class="meta">@Component(module = MainApplicationModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainApplicationComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainApplication mainApplication)</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplication.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> <span class="keyword">extends</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MainApplicationComponent component;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">    component = DaggerMainApplicationComponent.builder()</span><br><span class="line">                .MainApplicationModule(<span class="keyword">new</span> <span class="title class_">MainApplicationModule</span>(<span class="built_in">this</span>))</span><br><span class="line">                .build();</span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    component().inject(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在MainModule中我们提供了ApplicationContext类型的注入。前面说到Application类的提供的注入是供整个应用使用的，那么如果MainActivity需要使用到MainModule中提供的ApplicationContext类型怎么办？这里就要用到Component间的依赖了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivityComopnent.java</span></span><br><span class="line"><span class="comment">//我们将MainActivityComponent修改如下，在@Component注解中加上dependencies参数</span></span><br><span class="line"><span class="comment">//此时MainActivityComponent即依赖于MainApplicationComponent</span></span><br><span class="line"><span class="meta">@Component(dependencies = MainApplicationComponent.class, module = MainActivityModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainActivityComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity mainActivity)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplicationComponent.java</span></span><br><span class="line"><span class="comment">//MainApplicationComponent要提供自己的ApplicationContext给其他Component类使用，</span></span><br><span class="line"><span class="comment">//需要在自己的类中定义相应的返回类型</span></span><br><span class="line"><span class="meta">@Component(module = MainApplicationModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainApplicationComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainApplication mainApplication)</span>;</span><br><span class="line">  <span class="comment">//增加Context返回类型的方法</span></span><br><span class="line">  Context <span class="title function_">getApplicationContext</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplication.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> <span class="keyword">extends</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MainApplicationComponent component;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">//增加一个方法来使MainActivity可以获得MainApplication中的MainApplicationComponent</span></span><br><span class="line">  <span class="keyword">public</span> MainApplicationComponent <span class="title function_">getComponent</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> component;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  MainActivityComponent mainComponent;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">//依赖的Component在子Component初始化需要提供实例，因此在MainApplication中定义getComponent()方法</span></span><br><span class="line">    <span class="comment">//可以查看Dagger2生成的代码，通过调用MainApplicationComponent中的getContext()方法来注入ApplicationContext</span></span><br><span class="line">    mainComponent = DaggerMainActivityComponent.builder()</span><br><span class="line">      .applicationComponent(((MainApplication) getApplication()).getComponent())</span><br><span class="line">      .build();</span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    mainComponent.inject(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结一下：需要依赖其他Component（一般称为子Component）需要在@Comopnent注解中定义dependencies参数，而被依赖的Component（一般称为父Component），需要将可为子Component提供的注入类型，定义成方法，以返回值来提供。</p>
<h3 id="SubComponent"><a href="#SubComponent" class="headerlink" title="@SubComponent"></a>@SubComponent</h3><p>@SubComponent从名字上就可以看出来其意思：子Component。上节讲的Component间的依赖也有子Component，那这2种子Component有什么区别呢。</p>
<p>其中最大的区别，就是前一种情况，父Component需要显式的增加相关返回值的方法；而@SubComponent定义了相关的子Component后，仅需在父Component中定义返回该子Component的方法。</p>
<p>另外从项目开发进程的角度，前一种情况，一般是定义了父Component后，比如MainApplicationComponent，一般这种Component可能会被其他Compoennt依赖，为了方便以后扩展，我们无论是否有子Compoenent依赖，都先将其可以提供的注入依赖定义为方法。而当某个子Component需要扩展时，则在@Comopnent注解中定义dependencies参数即可。</p>
<p>而后一种情况，MainActivityComponent所注入的Activity，可能我们没办法预见其会需要一个子Component（这种子Component一般是跟其有关系的Activity或者Fragment），因此，如果MainActivity页面后面需要托管某个Fragment，比如MainFragment，则先用@SubComponent注释MainFragmentComponent，然后再修改MainActivityComponent，加上返回MainFragmentComponent的方法。</p>
<p>即，前一种情况，父Component对子Component无感知，而后一种情况则恰恰相反，子Component不清楚其父Component。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivityComponent.java</span></span><br><span class="line"><span class="meta">@Component(dependencies = MainApplicationComponent.class, module = MainActivityModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainActivityComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity mainActivity)</span>;</span><br><span class="line">  <span class="comment">//增加MainFragmentComponent返回值的方法，</span></span><br><span class="line">  <span class="comment">//表示MainFragmentComponent是MainActivityComponent的子Component</span></span><br><span class="line">  MainFragmentComponent <span class="title function_">getMainFragmentComponent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainFragmentComponent.java</span></span><br><span class="line"><span class="comment">//子Component</span></span><br><span class="line"><span class="meta">@SubComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainFragmentComponent</span> &#123;</span><br><span class="line">  <span class="comment">//注入MainFragment</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainFragment mainFragment)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  MainActivityComponent mainComponent;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">//增加方法，返回MainActivityComponent，方便MainFragment调用</span></span><br><span class="line">  <span class="keyword">public</span> MainActivityComponent <span class="title function_">getMainActivityComponent</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mainComponent;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainFragment.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainFragment</span> <span class="keyword">extends</span> <span class="title class_">Fragment</span> &#123;</span><br><span class="line">  MainFragmentComponent mainFragmentComponent;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onActivityCreated</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="comment">//通过MainActivityComponent类中的方法来获取子Component</span></span><br><span class="line">    mainFragmentComponent = ((MainActiivty) getActivity).getMainActivityComponent()</span><br><span class="line">      .getMainFragmentComponent();</span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    mainFragmentComponent.inject(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a>@Scope</h3><p>@Scope用来限定@Module或@Inject提供的注入元素的作用域。在Java开发中，最常用的设计模式就是单例模式了，单例模式即类在整个应用生命周期或者某一段生命周期中只有一个实例。而Java提供了@Singleton用于注解仅单个实例的类。Dagger2使用@Scope来注解自定义的作用域类，自定义的@Scope类可以作用于@Component类或者@Provides方法，表示整个@Component提供的注入元素均为单例，或者某个@Provides方法提供的注入元素为单例。</p>
<p>此处的单例，是跟随@Component类的实例生存周期一致的，而@Component类如果是在Application中初始化，则很明示整个APP应用生命周期内，该@Component提供的注入元素为单例，如果是在Activity内onCreate方法中初始化，则只要onCreate方法不再次被调用（一般就是Activity的生命周期），则@Component提供的注入元素为单例。</p>
<p>所以无论是@Singleton还是自定义的@Scope，其实是跟随@Component的被初始化情况来决定单例的作用域的，而他们更大的作用，其实是为了增强代码可读性。比如@ApplicationScope、@ActivityScope。其中@Module提供注入方法注解的@Scope必须与@Module类注解的@Scope一致，比如均为@Singleton或者@PerActivity。而@Component之间有依赖关系的，如果都有@Scope修饰，则不能为相同@Scope注解，否则编译会报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PerActivity.java</span></span><br><span class="line"><span class="comment">//自定义Scope</span></span><br><span class="line"><span class="comment">//表示单个Activity生命周期注入的实例均为单例[根据字面意思，只是方便理解，并不是真的有这层限制]</span></span><br><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PerActivity &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplicationModule.java</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplicationModule</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> MainApplication application;</span><br><span class="line">  MainApplicationModule(MainApplication application) &#123;</span><br><span class="line">    <span class="built_in">this</span>.application = application;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//表示单例，此时相应的Component类也要注解@Singleton</span></span><br><span class="line">  <span class="meta">@Singleton</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  <span class="keyword">public</span> Context <span class="title function_">providerApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> application;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainApplicationComponent.java</span></span><br><span class="line"><span class="comment">//MainApplicationComponent注入的类的生命周期内，其所注入的元素均为单例</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(module = MainApplicationModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainApplicationComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainApplication mainApplication)</span>;</span><br><span class="line">  <span class="comment">//增加Context返回类型的方法</span></span><br><span class="line">  Context <span class="title function_">getApplicationContext</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainActivityComponent.java</span></span><br><span class="line"><span class="comment">//MainActivityComponent依赖MainApplicationComponent，</span></span><br><span class="line"><span class="comment">//如果其也声明为单例，则不能与MainApplicationComponent声明的@Singleton注解相同</span></span><br><span class="line"><span class="comment">//（虽然作用是一样的，但要表明是不同的作用域）</span></span><br><span class="line"><span class="meta">@PerActivity</span></span><br><span class="line"><span class="meta">@Component(dependencies = MainApplicationComponent.class, module = MainActivityModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainActivityComponent</span>&#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity mainActivity)</span>;</span><br><span class="line">  <span class="comment">//增加MainFragmentComponent返回值的方法，</span></span><br><span class="line">  <span class="comment">//表示MainFragmentComponent是MainActivityComponent的子Component</span></span><br><span class="line">  MainFragmentComponent <span class="title function_">getMainFragmentComponent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//PerFragment.java</span></span><br><span class="line"><span class="comment">//自定义Scope</span></span><br><span class="line"><span class="comment">//表示单个Fragment生命周期注入的实例均为单例[根据字面意思，只是方便理解，并不是真的有这层限制]</span></span><br><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PerFragment &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainFragmentComponent.java</span></span><br><span class="line"><span class="comment">//子Component声明的作用域也不能与其父Component（即MainActivityComponent）一致</span></span><br><span class="line"><span class="comment">//其实@PerFragment与@PerActivity代码是一样的</span></span><br><span class="line"><span class="meta">@PerFragment</span></span><br><span class="line"><span class="meta">@SubComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainFragmentComponent</span> &#123;</span><br><span class="line">  <span class="comment">//注入MainFragment</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainFragment mainFragment)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IntoSet-ElementsIntoSet"><a href="#IntoSet-ElementsIntoSet" class="headerlink" title="@IntoSet&#x2F;@ElementsIntoSet"></a>@IntoSet&#x2F;@ElementsIntoSet</h3><p>@IntoMap和@ElementsIntoSet其实很好理解，可以用来注入集合。@IntoMap注入Map，@ElementsIntoSet注入Set。看代码就明白了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivityModule</span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@StringKey(&quot;name&quot;)</span> <span class="comment">//声明Map中的key值</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  String <span class="title function_">providerName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;name&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@IntoMap</span></span><br><span class="line">  <span class="meta">@StringKey(&quot;pwd&quot;)</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  String <span class="title function_">providerPwd</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;pwd&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ElementsIntoSet</span></span><br><span class="line">  String <span class="title function_">providerName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;lilei&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ElementsIntoSet</span></span><br><span class="line">  String <span class="title function_">providerMoreName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;zhangshang&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  HashMap&lt;String&gt; nameMap; <span class="comment">//map-&gt;&#123;&quot;name&quot;-&gt;&quot;name&quot;,&quot;pwd&quot;-&gt;&quot;pwd&quot;&#125;</span></span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  HashSet&lt;String&gt; nameSet; <span class="comment">//set-&gt;&#123;&quot;lilei&quot;,&quot;zhangshang&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Dagger2的知识点差不多就这些了。@IntoMap和@ElementsIntoSet其实很简单，不过可能用到的没那么多，因此放到这一章文章中。</p>
<p>以上内容均为个人学习理解，如果有错误之处，可以评论告诉我。共同学习，共同进步。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2016/10/03/Dagger2%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/10/03/Dagger2%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Dagger2详解1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-03 12:03:33" itemprop="dateCreated datePublished" datetime="2016-10-03T12:03:33+08:00">2016-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>看了许多Dagger2的文章，主要包括：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/cd2c1c9f68d4">Android：dagger2让你爱不释手系列 </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/luxiaoming/dagger2Demo">Dagger2图文完全教程</a></li>
</ul>
<p>但感觉有的文章光有原理没有例子，有的光讲例子，原理又讲的比较少。因此我也来写一篇Dagger2的文章，尽量结合2者，供大家交流学习。</p>
<h3 id="Inject、-Qualifier"><a href="#Inject、-Qualifier" class="headerlink" title="@Inject、@Qualifier"></a>@Inject、@Qualifier</h3><p>如果我们项目中自己定义的类，比如User类，需要注入到MainActivity中，用来代替<code>new User()</code>，那么在User类中使用@Inject注解User的构造函数表示提供注入，@Inject注解MainActivity中User类的实例属性来表示注入处。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  User user; <span class="comment">//我需要new User()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//User.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  String name;</span><br><span class="line">  String pwd;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="comment">//我来提供new User()</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果User类有多个构造函数，则需要@Qualifier定义的注解来区分，比如官方的@Named注解</p>
<p>@Qualifier主要是为解决实例提供方有提供多个相同类型的实例时，加以区分，在这里多种构造函数算其中一种情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Dagger2官方提供的@Named注解源码</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Named &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The name.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//User.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  String name;</span><br><span class="line">  String pwd;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="comment">//我来提供new User()</span></span><br><span class="line">  <span class="meta">@Named(&quot;user&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Named(&quot;user_with_value&quot;)</span> <span class="comment">//我来提供new User(String, String)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String pwd)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">    <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  <span class="meta">@Named(&quot;user&quot;)</span></span><br><span class="line">  User user;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  <span class="meta">@Named(&quot;user_with_value&quot;)</span></span><br><span class="line">  User userWithValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Module、-Component和-Provides"><a href="#Module、-Component和-Provides" class="headerlink" title="@Module、@Component和@Provides"></a>@Module、@Component和@Provides</h3><p>Module的引入是为了解决第三库提供的实例注入问题，比如User类是某个第三方库的文件，那么我们没办法在其构造函数上增加@Inject注解。这时候可以通过@Module注解的类中以@Provides注解相应返回类型为User的方法来提供实例</p>
<p><strong>如果你原先的代码现在需要引入Dagger2，也可以通过@Module方式来提供注入，这样基本不用修改原有代码，另外可以把<u><code>某个页面</code></u>需要注入的实例全部在Module类中提供，也方便维护。而这里的<u><code>某个页面</code></u>具体要怎么划分，是单个activity或者单个功能，就看情况而定了，目前大多数推荐是以页面来划分Module</strong></p>
<p>我们选择以页面切分Module，以下Module中提供的依赖供MainActivity页面使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivityModule.java</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivityModule</span> &#123;</span><br><span class="line">  <span class="comment">//返回值表示提供User类的实例注入，Dagger2官方推荐providerXX作方法名</span></span><br><span class="line">  <span class="comment">//如果是在Module中提供多个相同返回类型，也需要用到@Qualified注解过的注解来区分</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  <span class="meta">@Named(&quot;user&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">providerUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这里的参数类型为String，如果有@Provides注解的方法返回值为String，就会被自动注入，</span></span><br><span class="line">  <span class="comment">//因此这里比较好的提供参数呢？？我也不知道[摊手]</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  <span class="meta">@Named(&quot;user_with_value&quot;)</span> </span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">providerValueableUser</span><span class="params">(String name, String pwd)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(name, pwd);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果通过@Inject和@Module都有提供User类的注入依赖，按照Dagger2的处理，优先使用@Module类中提供的注入。</p>
<p>如果User类仅在MainActivityModule类中有定义提供注入的方法，那么在MainActivity.java类中@Inject的属性如何初始化呢？这时候Dagger2提供@Component类来关联：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivityComponent.java</span></span><br><span class="line"><span class="comment">//定义module值来表示MainComponent可以提供MainActivityModule中的注入</span></span><br><span class="line"><span class="meta">@Component(module = MainActivityModule.class)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainActivityComponent</span> &#123;</span><br><span class="line">  <span class="comment">//Dagger2推荐injectXX(Object)方法来定义Component要注入的地方</span></span><br><span class="line">  <span class="comment">//Dagger2通过自动生成代码，把MainActivity中要注入的实例，</span></span><br><span class="line">  <span class="comment">//与MainActivityModule中提供的实例初始化方法相关联</span></span><br><span class="line">  <span class="comment">//相当于User user[MainActivity提供] = new User()[MainActivityModule提供]</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity mainActivity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时，需要把MainComponent与MainActivity关联，这部分代码用到了Dagger2自动生成的代码。所以需要先编译工程，然后在MainActivity.java中加上以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MainActivity.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  <span class="meta">@Named(&quot;user&quot;)</span></span><br><span class="line">  User user; <span class="comment">//从MainActivityModule中注入</span></span><br><span class="line"></span><br><span class="line">  MainActivityComponent mainComponent; <span class="comment">//Component需要初始化</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    <span class="comment">//DaggerMainActivityComponent是Dagger2通过编译自动生成的，</span></span><br><span class="line">    <span class="comment">//可以去看看生成的代码是怎么把@Module和@Inject关联起来的</span></span><br><span class="line">    mainComponent = DaggerMainActivityComponent.builder()</span><br><span class="line">        .build();</span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    mainComponent.inject(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上讲解了：</p>
<ol>
<li><p>@Inject注解在<code>需要注入</code>和<code>提供注入</code>处；</p>
</li>
<li><p>@Inject注解在<code>需要注入</code>处；</p>
<p>@Module通过@Provides<code>提供注入</code>；</p>
<p>@Component在<code>需要注入页面</code>处初始化，来连接@Inject和@Module</p>
</li>
</ol>
<p>二种情况，也是Dagger2最基本的情况。<br>下一篇会再讲Dagger2复杂一点的用法。包括</p>
<ul>
<li>多个@Component间的依赖</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(dependencies = MainApplicationComponent.class,</span></span><br><span class="line"><span class="meta">           modules =&#123;MainActivityModule.class,ModuleB.class,ModuleA.class,MyModule.class&#125;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>子Component<code>@SubComponent</code></li>
<li>作用域<code>@Scope</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Singleton &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Map值<code>@IntoMap</code></p>
</li>
<li><p>Set值<code>@ElementsIntoSet</code></p>
</li>
<li><p>…</p>
</li>
</ul>
<p>也不知道啥时候会有下一篇！期待吧！</p>
<p>以上内容均为个人学习理解，如果有错误之处，可以评论告诉我。共同学习，共同进步。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2016/05/19/android%E5%A5%BD%E6%96%87%E6%94%B6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/05/19/android%E5%A5%BD%E6%96%87%E6%94%B6%E9%9B%86/" class="post-title-link" itemprop="url">android好文收集</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-05-19 18:06:18" itemprop="dateCreated datePublished" datetime="2016-05-19T18:06:18+08:00">2016-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><ol>
<li><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/guolin_blog/article/details/9097463">Android事件分发机制完全解析，带你从源码的角度彻底理解(上)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/guolin_blog/article/details/9153747">Android事件分发机制完全解析，带你从源码的角度彻底理解(下)</a></p>
<ul>
<li>onTouch() 方法返回false—&gt;onTouchEvents()—&gt;onClick()  </li>
<li>onInterceptTouchEvent默认返回false,优先子类处理点击事件，否则父view处理</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="http://gank.io/post/560e15be2dca930e00da1083">给 Android 开发者的 RxJava 详解</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://jaeger.itscoder.com/android/2016/08/28/android-hot-fix.html">Android 热修复方案对比</a></p>
</li>
</ol>
<h3 id="Android-tips-count"><a href="#Android-tips-count" class="headerlink" title="Android tips&#x2F;count"></a>Android tips&#x2F;count</h3><ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/jiang111/awesome-android-tips">awesome-android-tips</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zhujun2730/Android-Learning-Resources">Android学习资源网站大全</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://diycode.cc/topics/8">那些年你用过的 Android 开源项目都有什么?</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://blog.zhaiyifan.cn/2016/04/30/android-new-project-from-0-p5/">从零开始的Android新项目5 - Repository层(上) Retrofit、Repository组装</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/5e93c9101dc5">我所理解的RxJava——上手其实很简单（一）</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gank.io/post/560e15be2dca930e00da1083#toc_4">给 Android 开发者的 RxJava 详解</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.raye.wang/2017/02/24/quan-mian-liao-jie-nginxdao-di-neng-zuo-shi-yao/">全面了解Nginx到底能做什么</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/markzhai/AndroidProjectFrom0">https://github.com/markzhai/AndroidProjectFrom0</a> &lt;—这是啥？可以吃吗？</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://ydmmocoo.github.io/2016/06/22/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/">https://ydmmocoo.github.io/2016/06/22/Android%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/xiangzhihong/android-Interview">https://github.com/xiangzhihong/android-Interview</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/e99b5e8bd67b">http://www.jianshu.com/p/e99b5e8bd67b</a></p>
</li>
</ol>
<h3 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h3><ol>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/mc_hust/article/details/49517915">Android工程师面试题大全</a></li>
<li><a target="_blank" rel="noopener" href="http://yuweiguocn.github.io/2016/04/13/interview-2016-big-company/">2016Android某公司面试题</a></li>
</ol>
<h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><ol>
<li><a target="_blank" rel="noopener" href="http://www.oschina.net/translate/10-tips-git-next-level">10 个迅速提升你 Git 水平的提示</a></li>
</ol>
<h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><ol>
<li><a target="_blank" rel="noopener" href="https://design-patterns.readthedocs.io/zh_CN/latest/">图说设计模式</a></li>
</ol>
<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>dispatchTouchEvent</p>
<p>onInterceptTouchEvent</p>
<p>onTouchEvent</p>
<ol>
<li>android 事件分发：dispatchTouchEvent-&gt;onInterceptTouchEvent-&gt;onTouchEvent</li>
<li>android activity的生命周期：onCreate-onStart-onResume-onPause-onStop-onRestart-onDestroy</li>
<li>activity启动另一个activity时，先调用前一个activity的onPause-&gt;另一个activity的onResume</li>
</ol>
<p>保存数据操作可以在onStop中处理或者onDestroy</p>
<ol>
<li>fragment生命周期：onAttach-&gt;onCreate-&gt;onCreateView-&gt;onActivityCreated-&gt;onStart-&gt;onResume-&gt;onPause-&gt;onStop-&gt;onDestroyView-&gt;onDestroy-&gt;onDetach</li>
<li>service生命周期：bindService-&gt;onCreate-&gt;onBind-&gt;onUnBind-&gt;onDestroy</li>
</ol>
<p>startService-onCreate-&gt;onStartCommond-onStart</p>
<ol>
<li><p>BroadcastReceiver：registerBroadcast</p>
</li>
<li><p>Android设计模式[<a target="_blank" rel="noopener" href="https://gof.quanke.name/]">https://gof.quanke.name/]</a></p>
<ul>
<li>创建型-&gt;建造者模式、单例模式、简单工厂模式、工厂方法模式、抽象工厂模式、原型模式[6]</li>
<li>结构型-&gt;适配器模式、桥接模式、装饰模式、外观模式、享元模式、代理模式、组合模式[7]</li>
<li>行为型-&gt;策略模式、观察者模式、迭代器模式、责任链模式、命令模式、模板方法模式、访问者模式[7]</li>
</ul>
</li>
<li><p>创建型</p>
<ul>
<li>建造者模式，</li>
<li>单例模式，</li>
<li>简单工厂模式（在一个方法里面作判断,来返回相应的对象实例），</li>
<li>工厂方法模式（通过接口定义，子类实现来返回相应的对象实例），一般是静态方法</li>
<li>抽象工厂模式（通过接口定义，将具有同一主题的单独工厂封装在一起）</li>
<li>单例模式</li>
<li>原型模式（clone)</li>
</ul>
</li>
<li><p>结构型</p>
<ul>
<li><p>适配器模式，客户端：activity-&gt;listview.setAdapter(new MyAdapter());一个类的接口转换成用户所期待的，分为类适配器和对象适配器，类适配器表示为class Adapter implements Target extends Adaptee，通过继承来适配，一般不推荐。对象适配器表示为class Adapter implements Target{Adaptee mAdaptee},通过持有被适配对象的实例来适配</p>
<p>listview.getCount(),getItemPosition-&gt;Adapter-&gt;Target[ListView所需的getItem,getCount,]-&gt;Adaptee[数据集]</p>
</li>
<li><p>桥接模式，将抽象部分与它的实现部分分离，使它们都可以独立地变化</p>
</li>
<li><p>组合模式，组合多个对象形成树形结构以表示具有“整体—部分”关系的层次结构</p>
</li>
</ul>
</li>
<li><p>程序无响应。避免在UI线程执行大量耗时操作，可以使用AsyncTask,HandleThread,Service,Thread</p>
</li>
</ol>
<h3 id="Retrofit-Gson解析"><a href="#Retrofit-Gson解析" class="headerlink" title="Retrofit-Gson解析"></a>Retrofit-Gson解析</h3><p>每次都对应Bean对解析</p>
<p>Class-&gt;Callback<Person></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;lee&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Array-&gt;Callback&lt;List<Person>&gt;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">  	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;lee&quot;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;hu&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;female&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>每次请求都有状态码和状态值后，如果使用data把具体的对象包起来</p>
<p>封装一个Response</p>
<p>class-&gt;Callback&lt;Response<Person>&gt;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;lee&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Array-Callback&lt;Response&lt;List<Person>&gt;</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;lee&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;male&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;hu&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;female&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>Retrofit2可以替换的地方：addConvertFactory(GsonConvertFactory.create())-&gt;增加解析器，如gson解析，将最优先的解析器放在前面。addCallAdapterFactory(new ErrorHandleFacotry.create())&#x2F;addCallAdapterFactory(RxJavaCallAdapter.create())-&gt;替换成自定义call。</p>
<p>Gson中的GsonBuilder可以自定义，GsonBuilder().registerTypeAdapter(BaseResponse.class,new TypeAdapter() )与registerTypeAdapterFacotry(ItemTypeAdapterFactory.create())基本一致，用于自定义处理BaseResponse返回的数据</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2016/04/19/android%E9%9A%8F%E6%89%8B%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/04/19/android%E9%9A%8F%E6%89%8B%E8%AE%B0/" class="post-title-link" itemprop="url">Activity的生命周期和启动模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-04-19 12:56:28" itemprop="dateCreated datePublished" datetime="2016-04-19T12:56:28+08:00">2016-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>《Android开发艺术探索》笔记</p>
</blockquote>
<ol>
<li><p>启动新的Activity之前会先调用旧Activity的onPause()方法，因此在onPause()方法中不要做耗时操作</p>
</li>
<li><p>Activity可能被杀死的情况</p>
<ul>
<li>资源相关的系统配置发生变化。可以通过android:configuration来配置什么情况下不销毁重启Activity，常用属性包括<code>locale</code>,<code>oriontation</code>,<code>keyboardHidden</code>，即语言资源变化，横竖屏切换，键盘显示或隐藏。此时系统回调<code>onConfigurationChanged(Configuration newConfig)</code>函数。</li>
<li>系统内存不足。系统调用<code>onSaveInstanceState</code>-&gt;<code>onStop()</code>-&gt;<code>onDestroy()</code>，在<code>onSaveInstanceState</code>方法中保存信息；重建时调用，<code>onCreate()</code>-&gt;<code>onStart()</code>-&gt;<code>onRestoreInstanceState</code>，可以在<code>onCreate</code>或<code>onRestoreInstancestate</code>方法中恢复保存的信息。</li>
</ul>
</li>
<li><p><code>android:launchMode</code>属性：</p>
<ul>
<li><code>singleInstance</code>保证类存在单独的task中并仅存在一个实例，适合与程序分离的页面，如闹钟提醒页面；  </li>
<li><code>singleTop</code>表示类在当前task栈顶时，复用，此时调用<code>onNewInstance</code>方法，否则新建实例，适合消息通知类activity；</li>
<li><code>singleTask</code>表示类在当前task栈中存在时，清空在其上面的所有activity实例，直接复用，此时调用<code>onNewInstance</code>方法，否则新建实例，适合用于程序入口。</li>
</ul>
</li>
<li><p><code>android:taskAffinity</code>属性：</p>
<ul>
<li>定义该Activity所属的任务栈，默认为程序的包名。配合<code>launchMode</code>为<code>singleTask</code>时使用</li>
</ul>
</li>
<li><p>Activity的Flags</p>
<ul>
<li><code>FLAG_ACTIVITY_NEW_TASK</code><br>效果等同<code>android:launchMode=&quot;singleTask&quot;</code></li>
<li><code>FLAG_ACTIVITY_SINGLE_TOP</code><br>效果等同<code>android:launchMode=&quot;singleTop&quot;</code></li>
<li><code>FLAG_ACTIVITY_CLEAR_TOP</code><br>清空同一任务栈中在要启动Activity之上的Activity</li>
<li><code>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</code><br>不在历史Activity列表中显示，效果等同<code>android:excludeFromRecents=&quot;true&quot;</code></li>
</ul>
</li>
<li><p>Activity所在任务栈由其<code>taskAffinity</code>属性决定，默认为应用包名。新启动Activity若未指定<code>TaskAffinity</code>，则置于启动其的Activity所在任务栈的栈顶。非Activity的Context启动的Activity需要指定Flags为<code>FLAG_ACTIVITY_NEW_TASK</code>，比如从service中启动Activity，即以singleTask方法启动。</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2016/03/26/%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/03/26/%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">第一行代码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-03-26 10:13:24" itemprop="dateCreated datePublished" datetime="2016-03-26T10:13:24+08:00">2016-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="android系统架构"><a href="#android系统架构" class="headerlink" title="android系统架构"></a>android系统架构</h3><ol>
<li>Linux内核层</li>
<li>系统运行库层</li>
<li>应用框架层</li>
<li>应用层</li>
</ol>
<h3 id="隐式Intent"><a href="#隐式Intent" class="headerlink" title="隐式Intent"></a>隐式Intent</h3><ul>
<li><p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.activitytest.ACTION_START&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;com.example.activitytest.ACTION_START&quot;</span>);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<p><code>android.intent.category.DEFAULT</code>是一种默认的category，在调用startActivity()方法的时候会自动将这个category添加到Intent中。<br>所有intent-filter都必须添加<code>android.intent.category.DEFAULT</code>，除了LAUNCHER类别</p>
</li>
<li><p>分类<br><code>Intent.ACTION_VIEW</code>查看某个URL<br><code>Intent.ACTION_SEND</code>发送邮件<br><code>android.intent.category.LAUNCHER</code>表示activity应该显示在顶级应用启动器中<br><code>android.intent.category.INFO</code>表示activity向用户显示了包信息，但它不应该显示在启动器中</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-6/" class="post-title-link" itemprop="url">android学习笔记(6)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-11-19 16:19:46" itemprop="dateCreated datePublished" datetime="2015-11-19T16:19:46+08:00">2015-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><h3 id="保存内容到文件"><a href="#保存内容到文件" class="headerlink" title="保存内容到文件"></a>保存内容到文件</h3><ul>
<li>保存到内部存储(Internal Storage)</li>
<li>保存到外部存储(External Storage)</li>
</ul>
</li>
<li><h3 id="内部与外部存储比较"><a href="#内部与外部存储比较" class="headerlink" title="内部与外部存储比较"></a>内部与外部存储比较</h3><h4 id="内部存储"><a href="#内部存储" class="headerlink" title="内部存储"></a>内部存储</h4><ul>
<li>总是可用</li>
<li>保存的文件只能被当前应用访问</li>
<li>用户卸载应用后，内部存储保存的文件会被全部删除</li>
</ul>
<h4 id="外部存储"><a href="#外部存储" class="headerlink" title="外部存储"></a>外部存储</h4><ul>
<li>当用户挂载外部存储(SD卡)时可用，卸载后无法使用</li>
<li>其他应用可以访问</li>
<li>用户卸载应用后，系统将会删除通过<a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a>创建的目录</li>
</ul>
</li>
<li><h3 id="保存文件到内部存储"><a href="#保存文件到内部存储" class="headerlink" title="保存文件到内部存储"></a>保存文件到内部存储</h3><ul>
<li>getFilesDir()返回应用内部存储根目录</li>
<li>getCacheDir()返回应用内部存储缓存目录</li>
<li>创建文件<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(context.getFilesDir(), filename);</span><br></pre></td></tr></table></figure></li>
<li>通过openFileOutput或者FileOutputStream  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;myfile&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="string">&quot;Hello world!&quot;</span>;</span><br><span class="line">FileOutputStream outputStream;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  outputStream = openFileOutput(filename, Context.MODE_PRIVATE);</span><br><span class="line">  outputStream.write(string.getBytes());</span><br><span class="line">  outputStream.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>创建缓存文件<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> File <span class="title function_">getTempFile</span><span class="params">(Context context, String url)</span> &#123;</span><br><span class="line">    File file;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> Uri.parse(url).getLastPathSegment();</span><br><span class="line">        file = File.createTempFile(fileName, <span class="literal">null</span>, context.getCacheDir());</span><br><span class="line">    <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">// Error while creating file</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="保存文件到外部存储"><a href="#保存文件到外部存储" class="headerlink" title="保存文件到外部存储"></a>保存文件到外部存储</h3><ul>
<li>获取外部存储状态<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Checks if external storage is available for read and write */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isExternalStorageWritable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">state</span> <span class="operator">=</span> Environment.getExternalStorageState();</span><br><span class="line">    <span class="keyword">if</span> (Environment.MEDIA_MOUNTED.equals(state)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* Checks if external storage is available to at least read */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isExternalStorageReadable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">state</span> <span class="operator">=</span> Environment.getExternalStorageState();</span><br><span class="line">    <span class="keyword">if</span> (Environment.MEDIA_MOUNTED.equals(state) ||</span><br><span class="line">  Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>尽管external storage对于用户与其他app是可以修改的，但有2类文件可以保存在external storage中：<ul>
<li><strong>Public files</strong>这些文件对与用户与其他app来说是public的，当用户卸载你的app时，这些文件应该保留。例如，那些被你的app拍摄的图片或者下载的文件。</li>
<li><strong>Private files</strong>对其他app无意义的，当用户卸载你的app时，系统会删除你的app的private目录。例如，那些被你的app下载的缓存文件。<br></li>
</ul>
</li>
<li>如果你想要保存文件为public形式的，用<a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/os/Environment.html#getExternalStoragePublicDirectory(java.lang.String)">getExternalStoragePublicDirectory()</a>方法来获取一个 File 对象来表示存储在external storage的目录。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> File <span class="title function_">getAlbumStorageDir</span><span class="params">(String albumName)</span> &#123;</span><br><span class="line">    <span class="comment">// Get the directory for the user&#x27;s public pictures directory.</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(Environment.getExternalStoragePublicDirectory(</span><br><span class="line">    Environment.DIRECTORY_PICTURES), albumName);</span><br><span class="line">    <span class="keyword">if</span> (!file.mkdirs()) &#123;</span><br><span class="line">    Log.e(LOG_TAG, <span class="string">&quot;Directory not created&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li>
<li>如果你想要保存文件为私有的方式，你可以通过执行<a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/content/Context.html#getExternalFilesDir(java.lang.String)">getExternalFilesDir()</a>来获取相应的目录，并且传递一个指示文件类型的参数。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> File <span class="title function_">getAlbumStorageDir</span><span class="params">(Context context, String albumName)</span> &#123;</span><br><span class="line">    <span class="comment">// Get the directory for the app&#x27;s private pictures directory.</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(context.getExternalFilesDir(</span><br><span class="line">            Environment.DIRECTORY_PICTURES), albumName);</span><br><span class="line">    <span class="keyword">if</span> (!file.mkdirs()) &#123;</span><br><span class="line">        Log.e(LOG_TAG, <span class="string">&quot;Directory not created&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><h3 id="查询剩余空间"><a href="#查询剩余空间" class="headerlink" title="查询剩余空间"></a>查询剩余空间</h3><ul>
<li>通过执行<a target="_blank" rel="noopener" href="http://developer.android.com/reference/java/io/File.html#getFreeSpace()">getFreeSpace()</a> or <a target="_blank" rel="noopener" href="http://developer.android.com/reference/java/io/File.html#getTotalSpace()">getTotalSpace()</a> 来判断是否有足够的空间来保存文件，从而避免发生<a target="_blank" rel="noopener" href="http://developer.android.com/reference/java/io/IOException.html">IOException</a>。</li>
</ul>
</li>
<li><h3 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h3><ul>
<li>删除文件<code>myFile.delete()</code></li>
<li>如果文件是保存在internal storage，你可以通过Context来访问并通过执行deleteFile()进行删除<code>myContext.deleteFile(fileName);</code><blockquote>
<p>当用户卸载你的app时，android系统会删除以下文件：<br>所有保存到internal storage的文件。<br>所有使用getExternalFilesDir()方式保存在external storage的文件。<br>然而，通常来说，你应该手动删除所有通过 getCacheDir() 方式创建的缓存文件，以及那些不会再用到的文件。</p>
</blockquote>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-5/" class="post-title-link" itemprop="url">android学习笔记(5)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-11-19 14:33:27" itemprop="dateCreated datePublished" datetime="2015-11-19T14:33:27+08:00">2015-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><h3 id="获取SharedPreference"><a href="#获取SharedPreference" class="headerlink" title="获取SharedPreference"></a>获取SharedPreference</h3></li>
</ol>
<ul>
<li><p><a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/content/Context.html#getSharedPreferences(java.lang.String,int)">getSharedPreferences(String name, int mode)</a> — 通过名称，和访问mode来新建一个shared preference文件。mode值可以是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MODE_PRIVATE</span><br><span class="line">MODE_WORLD_READABLE</span><br><span class="line">MODE_WORLD_WRITEABLE</span><br><span class="line">MODE_MULTI_PROCESS</span><br></pre></td></tr></table></figure></li>
<li><p><a target="_blank" rel="noopener" href="http://developer.android.com/reference/android/app/Activity.html#getPreferences(int)">getPreferences()</a> — 创建默认的shared preference文件,app只需要一个preference文件时使用。</p>
</li>
<li><p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getActivity();</span><br><span class="line"><span class="type">SharedPreferences</span> <span class="variable">sharedPref</span> <span class="operator">=</span> context.getSharedPreferences(</span><br><span class="line">        getString(R.string.preference_file_key), Context.MODE_PRIVATE);</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><h3 id="写Shared-Preference"><a href="#写Shared-Preference" class="headerlink" title="写Shared Preference"></a>写Shared Preference</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SharedPreferences</span> <span class="variable">sharedPref</span> <span class="operator">=</span> getActivity().getPreferences(Context.MODE_PRIVATE);</span><br><span class="line">SharedPreferences.<span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> sharedPref.edit();</span><br><span class="line">editor.putInt(getString(R.string.saved_high_score), newHighScore);</span><br><span class="line">editor.commit();</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="读Shared-Preference"><a href="#读Shared-Preference" class="headerlink" title="读Shared Preference"></a>读Shared Preference</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SharedPreferences</span> <span class="variable">sharedPref</span> <span class="operator">=</span> getActivity().getPreferences(Context.MODE_PRIVATE);</span><br><span class="line"><span class="type">long</span> <span class="variable">default</span> <span class="operator">=</span> getResources().getInteger(R.string.saved_high_score_default));</span><br><span class="line"><span class="type">long</span> <span class="variable">highScore</span> <span class="operator">=</span> sharedPref.getInt(getString(R.string.saved_high_score), <span class="keyword">default</span>);</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sortbylist.github.io/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Jerry Lee">
      <meta itemprop="description" content="Java coder">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="书生小栈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2015/11/19/android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-4/" class="post-title-link" itemprop="url">android学习笔记(4)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2015-11-19 14:32:27" itemprop="dateCreated datePublished" datetime="2015-11-19T14:32:27+08:00">2015-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-04-01 16:35:09" itemprop="dateModified" datetime="2019-04-01T16:35:09+08:00">2019-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Android四大组件<br><code>Activity</code><br>   <code>Service</code><br>   <code>BroadCastReceiver</code><br>  <code>Content Provider</code></p>
</blockquote>
<h2 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h2><ol>
<li><h3 id="Activity的生命周期"><a href="#Activity的生命周期" class="headerlink" title="Activity的生命周期"></a>Activity的生命周期</h3></li>
</ol>
<ul>
<li>onCreate():创建</li>
<li>onStart():运行<ul>
<li>onResume():获取焦点</li>
<li>onPause():失去焦点</li>
<li>onStop():暂停</li>
<li>onDestroy():销毁</li>
<li>onRestart():重启</li>
</ul>
</li>
</ul>
<ol>
<li><h3 id="Activity四种状态"><a href="#Activity四种状态" class="headerlink" title="Activity四种状态"></a>Activity四种状态</h3></li>
</ol>
<ul>
<li>Activ&#x2F;Running 活动状态</li>
<li>Pause 暂停状态<ul>
<li>Stopped 停止状态</li>
<li>Killed 非活动状态</li>
</ul>
</li>
</ul>
<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><ol>
<li><h3 id="Fragment的生命周期"><a href="#Fragment的生命周期" class="headerlink" title="Fragment的生命周期"></a>Fragment的生命周期</h3></li>
</ol>
<ul>
<li>onAttach()</li>
<li>onCreate()</li>
<li>onCreateView()</li>
<li>onActivityCreated()</li>
<li>onStart()</li>
<li>onResume()</li>
<li>onPause()</li>
<li>onStop()</li>
<li>onDestoryView()</li>
<li>onDestory()</li>
<li>onDetach()</li>
</ul>
<h2 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h2><ol>
<li><h3 id="Intent实现页面之间跳转"><a href="#Intent实现页面之间跳转" class="headerlink" title="Intent实现页面之间跳转"></a>Intent实现页面之间跳转</h3><ul>
<li>startActivity(intent)</li>
<li>startActivityForResult(intent, requestCode, options)<ul>
<li>传递类 onActivityResult(int requestCode, int resultCode, Intent data)</li>
<li>接收类 setResult(int resultCode,Intent intent)</li>
</ul>
</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jerry Lee"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Jerry Lee</p>
  <div class="site-description" itemprop="description">Java coder</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/sortbylist" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sortbylist" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Lee</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
